---
title: "knobi"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{knobi}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(knobi)
```

```{r,echo=FALSE}
library(icesSAG)
```


In this vignette we illustrate the use of the `knobi` package through a real case example. For this purpose, the formulation of the Known Biomass Production Models (KBPM) is explained and then each of the functions of the package is described and applied to a real case example.



## 1. KBPM formulation

For a correct understanding of KBPM models, we begin by reviewing the framework of surplus production models (SPMs) and, then from this background we describe the KBPM formulation.

&nbsp;

Traditional SPMs are one of the most widely used data-limited (or data moderated) assessment models. Their general structure relates directly to Russell’s formulation of the stock dynamics:

$$B_{t+1}=B_t + f(B_t)-C_t$$ (1)

where *B<sub>t</sub>* is the stock biomass at the beginning of year *t*, *C<sub>t</sub>* is the biomass caught during year *t* and *f(B<sub>t</sub>)* is the biomass production function.

There are many formulations of the biomass production function *f(B<sub>t</sub>)*, among which the general Pella-Tomlinson (1969) is widely used:

$$f(B_t) = \frac{r}{p}{B_{t}} \left(1-\left( \frac{B_{t}}{K}\right) ^{p}\right)$$ (2)

where *r* is the intrinsic population growth rate, *K* is the virgin biomass and *p* is the asymmetry parameter, which allows non-symmetrical production curves and, consequently, maximum production different from *K/2*.

SPMs link the population dynamics (equation 1) with the observations through the relation between the catch and the stock biomass across the catchability coefficient (*q*). 

$$\hat{I}_t=C_t/E_t=qB_t$$
where *I<sub>t* is an index of relative biomass for year *t*, notation *ˆ* denotes an estimated value and *q* is the catchability coefficient, which scales the modeled stock biomass to match the trends in catch rates.

An alternative line of research based on surplus production models named known-biomass production models (KBPM) was developed (MacCall, 2002). The basis of the model is the idea that the annual surplus production in an unfished stock is equal to *B<sub>t+1</sub>-B<sub>t*, and that, for a fished stock, the calculation of surplus production depends on catch. 

$$SP_t=\overline{B}_{t+1}-\overline{B}_t+C_t$$ (3)

where *SP<sub>t</sub>* is the surplus production during year *t*, *<SPAN STYLE="text-decoration:overline">B</SPAN><sub>t</sub>* is the average biomass or SSB, *<SPAN STYLE="text-decoration:overline">B</SPAN><sub>t</sub>=(B<sub>t</sub>+B<sub>t+1</sub>)/2*, and *C<sub>t</sub>* represents the catch during year *t*.

In contrast to the traditional SPMs, KBPMs use as input data a biomass time series, estimated using another stock assessment model, instead of a biomass index. 

Once, the surplus production is calculated using the known average biomass (of two consecutive years) and the observed catch on equation (3), the KBPMs are fitted as:

$$SP_{t}= \frac{r}{p}\overline{B}_{t}\left(1-\left( \frac{\overline{B}_{t}}{K}\right) ^{p}\right)$$ (4)

Schaefer (1954) model corresponds to *p=1* (symmetric production curve and $SP_{max}=K/2$).


## 2. `knobi` package ##

In this section the `knobi` package functions are described. More precisely, in each one of the next sections the following package functions are explained:

1. `knobi_fit`: fits the KBPM model (main function).

2. `knobi_retro`: carries out the retrospective analysis.

3. `knobi_env`: analyzes the productivity changes in response to environmental fluctuations.

4. `knobi_proj`: projects the population and fishery dynamics.


### 2.1. `knobi_fit` ###

This section illustrates the use of the `knobi_fit` function, which allows us to execute the KBPM fit. 

For that, the case study of European hake ($Merluccius$ $merluccius$) is used. European hake is a resource of great commercial importance in Atlantic Iberian Waters. This species is assessed by the International Council for the Exploration of the Sea (ICES) in two units: the northern and the southern stocks. For the current illustration we focus on the northern hake unit which covers the subareas 4, 6, and 7, and divisions 3.a, 8.a–b, and 8.d (Greater North Sea, Celtic Seas, and the northern Bay of Biscay).



#### Creating `data` argument ####

The first step is to create the `data` input object.

The data is downloaded using the `icesSAG` package and saved in the `hake_n` object. Note that the time period goes from 1978 to 2020.

```{r}
hake_n <- icesSAG::getSAG(stock = "hke.27.3a46-8abd", year = 2021)
hake_n <- hake_n[-nrow(hake_n),]      # we remove last line because there is 
                                      # no information about catch in the last year

```

Then the `data` list for `knobi_fit` is created. Mandatory data are the catch time series of catches and the biomass or SSB time series, but in this example, as we have more information about the stock, it will also be included. 

As you can see, in the code below, we create the input argument `data` from the downloaded data. First we introduce both, the biomass and spawning biomass series, then below in the `control` argument we indicate which of the two series is used in the fit. Then, in the next line of code, we introduce the second data source which are the catches. After introducing the two main sources of information, we can add more details that are used mainly for comparing KBPM results to data rich ones. In this particular case, we add the recruitment series, the value of the reference point $F_{MSY}$, the type of fishing mortality used in the data rich model, and finally the years (if omitted, an increasing sequence from 1 onward will be used).

Details about the optional entries of this argument can be found on the help page.

```{r}
data <- list(
  Biomass = hake_n$biomass, 
  Spawning_Biomass = hake_n$SSB, 
  Catch = hake_n$catches,
  F_input = hake_n$F, 
  Recruitment = hake_n$recruitment,
  RP = list( F_MSY = 0.26),           # Provided by ICES        
  classF_input = "average",
  years = hake_n$Year )
```



#### Creating `control` object ####

`control` list contains a set of settings for the KBPM fit. In this example this list includes the objects `pella`, an optional logical where "TRUE" means that Pella-Tomlinson model is used instead the Schaefer model (the chosen option by default or when this argument is equal to "FALSE"); and `method`, a character type argument that sets whether the fit is carried using "SSB" or "Biomass". This argument is only required if both time series, `Spawning_Biomass` and `Biomass`, are provided in the `data` list, as in the example, where we chose the "SSB" option.

&nbsp;

```{r}
control <- list(
  pella = "TRUE", 
  method = "SSB")
```

There is the possibility of defining another `control` settings such as `start_r`, `start_K` or `start_p`, optional start values of the model parameters $r$ (intrinsic growth rate), $K$ (maximum population size) and $p$ (shape parameter in Pella-Tomlinson model), respectively.


#### KBPM model fit ####

After preparing both lists, `data` and `control`, we can apply the `knobi_fit` function over them for the fit of the KBPM model. 

In addition to the arguments mentioned above, the `plot_out=TRUE` argument allows, in addition to the internal plots of R, the creation of an external folder with the corresponding plots files. We can set the file name of the folder and its directory through the `plot_filename` and the `plot_dir` arguments, respectively. In this example, we create a folder for the plots whose name is "hake_n" and that is going to be saved in "Z:/knobi/HAKE/".

```{r,eval=FALSE}
hake_n_results <- knobi_fit( data = data, 
                             control = control,
                             plot_out = TRUE, 
                             plot_filename = "hake_n", 
                             plot_dir = "Z:/knobi/HAKE/")
```

Note that if the length of the input catch time series does not match with the SSB length, a warning is returned indicating that the series of catch is reduced so that the fit can be done.

```{r,echo=FALSE, fig.show='hide'}
hake_n_results <- knobi_fit(data,control,plot_out=FALSE)
```

The following input quantities are plotted: fishing mortality time series, SSB, surplus production and catch time series. Note that in this example we are using `control$method=SSB`, which means that we are going to operate with the SSB and not with the stock biomass. Plots of catch over fishing mortality, fishing mortality over SSB, and catch over SSB time series with a smooth line from a "loess" regression are also available. Plot of input-output time series of fishing mortality is provided with horizontal lines at fishing mortality at MSY (two lines representing the input and output quantities, in this case, because the input $F_{msy}$ is provided). The relative fishing mortality plot is also displayed, that is the relation between the fishing mortality and $F_{msy}$, and where a horizontal line equal to 1 is added, where values greater than this amount would inform us of a state of overfishing, as occurs in almost the entire time series in our case study. The analogous SSB plots are also reported. On the other hand, the fitted surplus production curve is plotted twice with the SSB and SP observations (first) and with the catch and SP observations (second). Finally, a plot with the KBPM fit residuals is reported.

```{r,echo=FALSE, warning=FALSE, fig.width=7, fig.height=5}
hake_n_results <- knobi_fit(data,control,plot_out=FALSE)
```


#### Quantitative results ####

The output prints out the formula and the parameter estimates of the fit.

```{r}
hake_n_results
```


The complete output object is the input list updated with the fitting information. The `control` output is the input one updated with the information of the plot settings. The `data` output is also the updated input including the annual average biomass, the surplus production and the F estimated time series. The results of the KBPM fit are in the `$fit` list slot, that contains, e.g., the model parameters estimates, the biological reference points estimates or goodness-of-fit measures. See the function help for the complete list information.


### 2.2. `knobi_retro` ###

Once the KBPM fit is carried out using `knobi_fit`, its robustness to the systematic deletion of last year's data is tested using the `knobi_retro` function.

`knobi_retro` input is the object returned by `knobi_fit` and the number of retrospective patterns. Note that `nR` specifies the number of fits to carry out. The first model considers the data deleting the last year and fits the surplus production curve, the next model deletes the two last years of the original data set and fits the SP curve, and then continues in this way until the last model is reached in which the last `nR` years in the original data are deleted to then fit the curve.

```{r,eval=FALSE}
hake_n_retros <- knobi_retro( knobi_results = hake_n_results,         
                              nR = 5,            
                              plot_out = TRUE,
                              plot_filename = "hake_n",
                              plot_dir = "Z:/knobi/HAKE/")
```

The estimated surplus production curves from the retrospective analysis are plotted. The plot is displayed in the plot window and saved (note that `plot_out=T`) in the provided directory and file, which are the same as in the previous function example in this case.

```{r,echo=FALSE, fig.width=7, fig.height=5}
hake_n_retros <- knobi_retro(hake_n_results,nR=5,plot_out=FALSE)
```


#### Quantitative results ####

The `knobi_retro` result object is a list containing the retrospective analysis, that includes the parameter estimates and the reference points for each one of the models.

```{r}
hake_n_retros
```

There is also the possibility of choosing the time series of the retrospective analysis models, through the arguments `yR`, a vector of catch time series final years in each one of the retrospective models; and `yR0`, an optional vector of catch time series starting years in each one of the retrospective models (if not entered, retrospective models fits from the first available year).

```{r, fig.width=7, fig.height=5}
knobi_retro( hake_n_results, 
             yR = c(2005,2010,2015))
```

```{r, fig.width=8, fig.height=6}
knobi_retro( hake_n_results,
             yR = c(2005,2010,2015),
             yR0 = c(1990,1995,1995))
```

Note that in these last two examples, plots are displayed but not saved.

### 2.3. `knobi_env` ###

After carrying out the KBPM fit using `knobi_fit`, `knobi_env` function allows us to analyse and model the relationships between surplus production and environmental covariable(s) to test whether productivity changes in response to environmental fluctuations in three steps: 

1.  The analysis of the correlation between the environmental variable(s) and the KBPM residuals through the Pearson's correlation or through the study of autoregressive models; 
2.  The selection of which lagged environmental variable(s) is included in the environmental KBPM models fit; 
3.  The KBPM environmental fit.

For step (3), the KBPM environmental fit, environmental effects are included as additive and multiplicative effects in the KBPM base formulation (equation 4).

* Additive model:

$$SP_{t}= \frac{r}{p}\overline{B}_{t}\left(1-\left( \frac{\overline{B}_{t}}{K}\right) ^{p}\right) + cX_t\overline{B}_{t}$$ (5)
being *c* the parameter that represent the effect of the environmental variable *X<sub>t</sub>* (*t* index represents years).

* Multiplicative model:

$$SP_{t}= \frac{r}{p}\overline{B}_{t}\left(1-\left( \frac{\overline{B}_{t}}{K}\right) ^{p}\right)exp^{cX_t}$$ (6)


`knobi_env` input is the object returned by `knobi_fit` and the object `data`, a list containing, at least, the mandatory environmental information required for the fit, which is the `env` argument, a data frame containing the values of each one of the environmental variable(s) in one column and where rows represent years; and `years`, the years in which the environmental variable(s) are reported.


```{r}
Env <- data.frame( 
          
  years = seq( 1973,2020),
          
  AMO =      c(-0.236,-0.441,-0.320,-0.385,-0.210,-0.201,-0.132,-0.041,-0.098,
               -0.235,-0.093,-0.230,-0.290,-0.297, 0.044,-0.028,-0.106,-0.061,
               -0.155,-0.242,-0.234,-0.200, 0.112,-0.082, 0.028, 0.349, 0.094,
                0.004, 0.095, 0.041, 0.207, 0.182, 0.268, 0.242, 0.123, 0.114,
                0.015, 0.325, 0.078, 0.189, 0.142, 0.077, 0.090, 0.318, 0.291,
                0.045, 0.150, 0.279),
          
  TMax_Vigo = c(16.5, 16.7, 17.1, 16.3, 16.4, 16.7, 17.3, 17.3, 17.4, 18.0,
                17.5, 17.5, 17.6, 18.0, 17.0, 18.4, 17.8, 19.6, 19.1, 18.0,
                17.9, 17.7, 17.7, 19.4, 18.2, 19.7, 19.2, 18.6, 18.0, 18.3,
                18.5, 18.8, 18.7, 18.7, 18.5, 17.9, 17.4, 19.2, 19.0, 19.7,
                18.0, 19.1, 19.4, 20.0, 19.5, 20.2, 18.8, 18.6))

years <- hake_n_results$data$years

ind <- which(Env[,1]==years[1])
ind1 <- which(Env[,1]==years[length(years)])

nlag <- 5

Env <- Env[(ind-nlag):ind1,]
```

Now, we create the `data` list

```{r}
data <- list(
  env = data.frame( AMO=Env$AMO, Tmax=Env$TMax_Vigo),
  years = Env$years)
```

In the optional `control` input list we provide the settings for the environmental fit. In this case, for example, we are going to set `nlag=5`. This argument is used to test all the lags smaller or equal to `nlag` (numeric). The lag corresponding to the highest correlation among the base KBPM surplus production residuals and the lagged environmental covariable(s) values is considered in the environmental model. This means that the *residuals<sub>t</sub>* is related to *X<sub>t-lag</sub>* being *X* the environmental variable and *lag=0,1,...,nlag*. The length of this argument must be equal to the number of environmental variables included. By default, `nlag=3`. Note that the environmental data series must start in the first year of the KBPM fit data minus the provided `nlag`.

```{r}
control <- list( nlag = nlag)
```

Furthermore, `knobi_env` has the same input settings for saving the plots than the previous functions, which in this case are also saved in the same provided directory and file like in the previous example. In this case, the first plot reports the correlation analysis between the environmental variable(s) and the base KBPM surplus production residuals. The last one reports the fitted values of the base model (no environmental information) and of the environmental ones.


```{r,eval=FALSE}
hake_n_environmental <- knobi_env(knobi_results = hake_n_results, 
                                 data = data,    
                                 control = control,
                                 plot_out = TRUE,
                                 plot_filename = "hake_n",
                                 plot_dir = "Z:/knobi/HAKE/"))
```


```{r,echo=FALSE, fig.width=7, fig.height=5}
hake_n_environmental <- knobi_env(hake_n_results,data,control)
```


#### Quantitative results ####

The output prints the formula and the parameters estimates for both environmental models fit.

```{r}
hake_n_environmental
```

The complete output object is a list containing the environmental analysis, which contains the parameter estimates for both models and its reference points estimates, the accuracy measures for each model or the correlation analysis between the environmental variable(s) and the KBPM base residuals, among other results. The complete list can be consulted in the function help.

Note that from equations (5) and (6), estimations of the most used reference points (RPs) are shown, but it has to be considered that RPs are dependent on the environmental covariable value, and then their values vary according to the environmental covariable values. Hence, for simplicity, the output reference points consider that the environmental covariable is 0. 

In the case of the multiplicative model, the RPs that depends on the environmental covariable are *F<sub>msy</sub>* and *MSY*. If the user wants to know their values at a specific environmental covariable value, please multiply this RPs by *cX<sub>t*. 

In the case of the additive model, all RPs depend on the environmental covariable values. If the user wants to know their values at a specific environmental covariable value, consider the following equations:

$$B_{msy}(X_t)=K\left(\frac{p c X_t+r}{r(p+1)}\right)^{1/p}$$
$$F_{msy}(X_t)=F_{msy}-\frac{cX_t}{p+1}+cX_t$$
$$MSY(X_t)=B_{msy}(X_t)*F_{msy}(X_t)$$
$$K(X_t)=K+cX_t$$
*F<sub>msy</sub>*, *B<sub>msy</sub>* and *K* are the RP estimates for *X<sub>t</sub>=0*. 
*RP(X<sub>t</sub>)* represents the dependence of each RP in relation to the environmental variable.


#### More options ####

There is the possibility of obtaining 3D plots that reports the surplus production curve conditioned to a grid of environmental values, through the argument `control$plot3d=TRUE`. In this case, a list named `plots3D` is added to the output list of `knobi_env` with the 3D plots objects.

```{r, eval=FALSE}
control$plot3d = TRUE
knobi_env( hake_n_results, data, control)
```

As mentioned above, when more than one environmental variable is introduced in `data`, the fit is made, by default, with the most correlated environmental variable considering the selected lag, but there is the possibility of choosing one of the introduced variables through the argument `selected_var` inside the `control` list. 

```{r, eval=FALSE}
control$selected_var <- "AMO"
knobi_env( hake_n_results, data, control)
```

There is also the possibility of fixing lag value(s) in the relation among the surplus production and the environmental variable, using `lag` instead of `nlag` inside `control`.

Furthermore, it is also possible to fit the environmental models considering more environmental variables, up to a total of 5 covariates, using `control$multicovar = TRUE`. This means that *cX<sub>t</sub>* is replaced by *sum<sub>{i in 1...n}</sub>(c<sub>i</sub>X<sub>t,i</sub>)* in equations (5) and (6), where index *n* represents each environmental variable.

In this example, 3D plots are never reported, and a plot with the Pearson correlation between the environmental variables is displayed. The output list slightly differs from the previous one (see the package help)

For the RP estimation when *X<sub>t* is not equal to 0, you have to replace the term *cX<sub>t* in the previous *RP(X<sub>t</sub>)* equations by *sum<sub>i in 1...n</sub>(c<sub>i</sub>X<sub>t,i</sub>)*, where *n* is the number of covariates.

```{r, eval=FALSE}
data <- list( env=data.frame(AMO=Env$AMO,Tmax=Env$TMax_Vigo), years=Env$years)
control <- list( lag=c(2,3), multicovar=TRUE)

hake_n_multi <- knobi_env( hake_n_results, data, control)
```


At last, there is the possibility of testing the correlation between the KBPM residuals and the environmental variable(s) through the fit of autoregressive models (AR models). In this case, an AR model is fitted for the residuals in order to determine, in the first place, how the residuals can explain themselves as follows

$$ r_t=\sum_{i=1}^{p}\beta_{i}r_{t-i}+\epsilon_{t}$$

being $r_t$ the KBPM base SP residual for year $t$ and $p$ the AR model order, estimated as the maximum partial autocorrelation function value (in absolute terms) that is bigger than $qnorm(0.975)/\sqrt(length(r))$.

Then, an AR model is fitted considering the lagged environmental variable(s) considering each variable and lag as follows

$$r_{t,lag}=\sum_{i=1}^{p}\beta_{i}r_{t-i}+X_{t-lag}+\epsilon_{t}$$
for ${lag=0,1,...,nlag}$, being $X_{t,lag}$ the lagged environmental variable, for each lag corresponding to $lag=\{0,1,...,nlag\}$.

For each model, the Akaike information criterion (AIC) is estimated, comparing the value obtained for the AR model with the residuals only and their values for the AR models considering each environmental variable and for each lag (only works with the argument `nlag`).

This test is performed using the argument `ar_cor = TRUE` in `control` list. By default this argument is `FALSE`, which means the correlation between the KBPM base residuals and the environmental variable(s) is tested through a Pearson correlation test, as mentioned above. The environmental variable whose AR model shows a lower AIC (with its corresponding lag) is used in the environmental adjustment if the environmental variable is not fixed.

`env_aic` is returned in the output list, a data frame with the AIC values obtained for the AR model considering each environmental variable(s) for each lag among the AIC value for the AR model considering only the KBPM base SP residuals and the correlation plot shows this values; and `selected_lag` shows, in this case, the estimated lag corresponding to the one reporting the lowest AIC between the environmental variable and the base KBPM surplus production residuals (derived if lag is not fixed) or the fixed lag and the correlation corresponding to this lag for each variable.


```{r, eval=FALSE}
data <- list( env=data.frame(AMO=Env$AMO,Tmax=Env$TMax_Vigo), years=Env$years)
control <- list( nlag=3, ar_cor=TRUE)
knobi_env( hake_n_results, data, control)
```


### 2.4. `knobi_proj` ###

`knobi_proj` function allows us to project the stock biomass (or stock spawning biomass) time series and then the surplus production based on the selected catch or fishing mortality values for future years after carrying out the KBPM fit using `knobi_fit` or the environmental KBPM fit using `knobi_env`.

`knobi_proj` input is the object returned by `knobi_fit` and, in this case, the following information (`end_y`) and a data frame that establishes the catch values for each one of the projected years (`Ct`). As can be seen in this example, different catch scenarios are allowed and can be defined in each of the data frame or matrix columns. Note that the number of rows of the data frame must be equal to the number of projected years. Different ways to enter this information are described in the package help.

In this case, we create the data frame containing the selected catch for the projected years, from 2001 to 2007 (note that `end_y` is equal to the last year of the KBPM base fit plus 8 years). Three catch scenarios are considered: (i) constant catch value equal to the last historical catch multiplied by 1, (ii) last historical catch multiplied by 1.2 and constant; and (iii) last historical catch multiplied by 0.8 and constant.

The resulting plots are displayed in the plot window. In this example, four plots are presented in a panel reporting the biomass, surplus production, catch and fishing mortality projections for each catch scenario. Note that, in this case, `plot_out = FALSE` (by default), then plots are not saved like in the previous examples.

```{r}
catch <- rep(hake_n_results$data$Catch[length(hake_n_results$data$Catch)],8)
Ct <- data.frame(catch=catch, catch08=0.8*catch, catch12=1.2*catch)

projections <- knobi_proj( knobi_results=hake_n_results, Ct=Ct, end_y=2027)
```

#### Quantitative results ####

The output prints the biomass and surplus production projections for each scenario.

```{r}
projections
```

The complete output object is a list containing the projection estimates for each of the catch scenarios, which is detailed in the package help


#### With environmental information ####

There is the possibility of considering the environmental information in the forecasts. For this purpose, it has to be provided the `knobi_env` results and the new environmental information through the arguments `env_results`, the output object of the `knobi_env` function; and `env`, the environmental variable(s) projections.

In this example, the future values of the environmental variable(s) are included in a data frame containing the environmental covariable values for the projected years. Three scenarios are considered: (i) Constant maximum year temperature equal to 19 degrees (centigrade); (ii) temperature equal to 19 degrees and then constant raise of 0.5 degrees; and (iii) temperature equal to 19 and then constant raise of 1 degrees.


```{r}
env <- data.frame( Tmax_cte=c(19,19,19,19,19),
                   Tmax_05=c(19,19.5,20,20.5,21),
                   Tmax_1=c(19,20,21,22,23))

catch <- rep(hake_n_results$data$Catch[length(hake_n_results$data$Catch)],5)

Ct <- data.frame( catch=catch,
                  catch08=0.8*catch,
                  catch12=1.2*catch)
```

Furthermore, we use `n_y` instead of the `end_y` argument, which is the number of years for projections (5 years in this example). Note: If both are provided, `n_y` is used.

In this case, the plots are presented in a panel for each catch or fishing mortality scenario reporting biomass, surplus production, catch and fishing mortality projections in each of the environmental scenarios.

```{r}
knobi_proj(hake_n_results, hake_n_environmental, Ct=Ct, n_y=5, env=env)
```

The output list also contains the projections for each of the scenarios considered for both catches and environmental variability, which also, as can be seen in detail in the package help, can be obtained based on each of the considered models.


#### Forecast through fishing mortality ####

There is also the possibility of forecast through projections for fishing mortality instead of catch, considering or not the environmental information. In this case, input `Ct` is replaced by `f`. Different scenarios are also allowed.

```{r, eval=FALSE}
fmsy <- hake_n_results$fit$RP$F_MSY
ff <- rep(fmsy,5)
f <- data.frame( f=ff, f12=ff*1.2, f08=ff*0.8)

knobi_proj( hake_n_results, f=f, n_y=5, env_results=hake_n_environmental, env=env)
```


#### Case of considering multicovariate environmental models #### 

In the case of `multicovar = TRUE` in `knobi_env`, an example of the list that is required, each item is a data frame for each environmental scenario.

```{r, eval=FALSE}
env <- list( climate_1 = data.frame( AMO=c(0.2,0.2,0.3,0.3,0.4),
                                     Tmax_Vigo=c(19,19,20,20,21)),
             climate_2 = data.frame( AMO=c(0.2,0.3,0.4,0.5,0.6),
                                     Tmax_Vigo=c(19,20,21,22,23)))

multiproj <- knobi_proj( hake_n_results, hake_n_multi, Ct=Ct[1:5,], n_y=5, env=env)
```



## References ##

Schaefer, M.B. (1954). Some Aspects of the Dynamics of Populations Important to the Management of the Commercial Marine Fisheries. Bulletin of the Inter-American Tropical Tuna Commission. 1:26-56.

Pella, J.J., Tomlinson, P.K. (1969). A generalized stock-production model. Bulletin of the Inter-American Tropical Tuna Commission. 13:421–58.

MacCall, A. (2002). Use of Known-Biomass Production Models to Determine Productivity of West Coast Groundfish Stocks. North American Journal of Fisheries Management, 22, 272-279.
